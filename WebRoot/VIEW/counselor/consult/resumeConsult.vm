<script src="$link.contextPath/STATIC/js/fileinput.js"></script>
<link rel="stylesheet" href="$link.contextPath/STATIC/css/fileinput.css"/>
<script src="$link.contextPath/STATIC/js/jquery.form.js"></script>
<link rel="stylesheet" href="$link.contextPath/STATIC/plugin/ueditor/themes/default/css/ueditor.css" type="text/css">
<script type="text/javascript" charset="utf-8" src="$link.contextPath/STATIC/plugin/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="utf-8" src="$link.contextPath/STATIC/plugin/ueditor/ueditor.all.js"></script>
<script type="text/javascript" charset="utf-8" src="$link.contextPath/STATIC/plugin/ueditor/lang/zh-cn/zh-cn.js"></script>

#parse("counselor/counselorGuide.vm")
<div class="alert alert-dismissable alert-success">
	#parse("counselor/consult/common/consultBaseInfoCommon.vm")
  	#if($consultBase.consult.step==1)
  			<p>	您可以有如下选择：
			<button  class="btn btn-primary btn-xs" onclick="acceptConsult($consultBase.consult.id)"><span class="glyphicon glyphicon-ok"></span> 接受预约</button>
			<button  class="btn btn-warning btn-xs" data-toggle="modal" data-target="#rejectConsult" ><span class="glyphicon glyphicon-remove"></span> 拒绝预约</button>
			</p>		
	#end
	#if($consultBase.consult.step==2)
			<p>	您可以有如下选择：
			<button  class="btn btn-primary btn-xs" onclick="completeConsult($consultBase.consult.id)"><span class="glyphicon glyphicon-stop"></span> 结束咨询</button>
			</p>
	#end
</div>
#parse("counselor/consult/common/consultConsultantCommon.vm")

<div class="row">
	<div class="col-sm-12">
		<div class="panel panel-default">
		  <div class="panel-body">
			  <table class="table" style="margin-bottom:0px;">
			    <tr>
			      <td width="20%"><span class="glyphicon glyphicon-tag">咨询描述：</span></td>
			      <td width="80%">$consultBase.consult.goal</td>
			    </tr>				  
			    <tr>
			      <td width="20%"><span class="glyphicon glyphicon-paperclip">上传的简历文件：</span></td>
			      <td width="80%"><span class="glyphicon glyphicon-download-alt"></span><a target="_blank" href="$link.contextPath$fileUtil.getPath($consultBase.resumeConsult.resumeFiles)" >$fileUtil.getFileName($consultBase.resumeConsult.resumeFiles)</a>
			      <small>请点击下载或直接阅览</small></td>
			    </tr>
			  </table>
	      </div>   
  		</div>
	</div>
</div>
#if($consultBase.consult.step!=1)
<div class="row">
	<div class="col-sm-12">
		<div class="panel panel-default">
		  <div class="panel-heading"><span class="glyphicon glyphicon-bookmark"></span> 咨询师区域  
		  #if($consultBase.resumeConsult.review && $consultBase.consult.step==2)	
		  <a href="javascript:void(0)" onclick="showReviewArea()" style="float:right"><span class="glyphicon glyphicon-edit"></span>修改review信息</a>
		  #end
		  </div>
		  <div class="panel-body">
		  		<form id="resumeConsultReviewForm" action="$link.contextPath/counselor/consult/resumeConsultReview.htm"  method="POST" enctype="multipart/form-data">
					#if($consultBase.resumeConsult.review)
					  <table class="table showReviewResumeArea" style="margin-bottom:0px;">
				    	<tr>
					      <td width="20%"><span class="glyphicon glyphicon-tag">修改建议：</span></td>
					      <td width="80%">$!consultBase.resumeConsult.review</td>
					    </tr>					  
					    <tr>
					      <td width="20%"><span class="glyphicon glyphicon-paperclip">批注的简历文件</span></td>
					      <td width="80%"><span class="glyphicon glyphicon-download-alt"></span><a target="_blank" href="$link.contextPath$fileUtil.getPath($consultBase.resumeConsult.reviewFiles)" >$fileUtil.getFileName($consultBase.resumeConsult.reviewFiles)</a>
					      <small>请点击下载或直接阅览</small></td>
					    </tr>
					  </table>
				  	#end	
				  	#if($consultBase.consult.step==2)
				  	<div class="#if($consultBase.resumeConsult.review) hide  #end" id="reviewResumeArea" >			
						<div class="alert alert-dismissable alert-info" style="margin:0px 0px 0px 0px">
						  	<p>请您修改咨询者的简历，或者对他的简历提出建议和意见,只允许上传word文档和pdf文档</p>
						</div>  	
						<br/>
				        <input  type="file" name="localFile"  class="file" multiple="false" data-show-upload="false" data-show-caption="true" />
				        <br/>
					    <script type="text/plain" id="reviewEditor" name="review" style="width:100%;height:200px;">$!consultBase.resumeConsult.review</script>
				       <script type="text/javascript">
					        var reviewEditor = UE.getEditor('reviewEditor', {
							    toolbars: [
							        ['fullscreen', 'source', 'undo', 'redo', 'bold']
							    ],
							    autoHeightEnabled: true,
							    autoFloatEnabled: true
							});
							
							function showReviewArea(){
								$('.showReviewResumeArea').hide();
								$('#reviewResumeArea').removeClass('hide')
							}
							function uploadResumeReview() {
								var hideForm = $('#resumeConsultReviewForm');
								var options = {
									dataType : "json",
									beforeSubmit : function() {
										$('#resumeConsultReviewButton').button('loading');
									},
									success : function(result) {
										$('#resumeConsultReviewButton').button('reset');
										var data = eval(result);
										if(data.result.success){
											alert('处理成功，请等待页面刷新！');
											window.location.reload();
										}else{
											alert('提交失败：'+data.result.message);
										}
									},
									error : function(result) {
										$('#resumeConsultReviewButton').button('reset');
										alert("上传失败");
									}
								};
								hideForm.ajaxSubmit(options);
							}
					    </script>   
					    <br/>
					    <input type="hidden" name="consultId" value="$consultBase.consult.id"/>
				    	<button type="button" id="resumeConsultReviewButton" class="btn btn-danger col-sm-2" style="float:right;" onclick="uploadResumeReview()">提交信息</button> 	 					    
				    </div>
				    #end
		    	</form>		    
  			</div>
  		</div>
	</div>
</div>
#end

#parse("counselor/consult/common/consultMessageCommon.vm")
#parse("counselor/consult/common/consultAppraiseCommon.vm")
#parse("counselor/consult/common/consultRejectCommon.vm")
<script>
	//接受预约
	function acceptConsult(consultId){
		jQuery.ajax({
             type: "POST",
             url: "$link.contextPath/counselor/consult/acceptConsult.json",
             data: {'consultId':consultId},
             dataType: "json",
             success: function(data){
             	if(data.result.success==true){
             		window.location.reload();
             	}else{
             		alert("发送失败"+data.result.message);
             	}
              }
         });
	}
	//完成请求
	function completeConsult(consultId){
		jQuery.ajax({
             type: "POST",
             url: "$link.contextPath/counselor/consult/completeResumeConsult.json",
             data: {'consultId':consultId},
             dataType: "json",
             success: function(data){
             	if(data.result.success==true){
             		window.location.reload();
             	}else{
             		alert("发送失败"+data.result.message);
             	}
              }
         });
	}
	
</script>